#include <stdio.h>
#include <string.h>

#define TEST(input, output) \
  do { \
    if (test(input, output)) { \
      printf("Error at %s\n", #input); \
      return -1; \
    } \
  } while(0)

void Initialize_Fast_IDCT(void);
void Fast_IDCT(short *block);

int test(const short *input, const short *output) {
  short block[64];

  memcpy(block, input, sizeof(block));
  Fast_IDCT(block);

  return memcmp(block, output, sizeof(block));
}

int main() {
  Initialize_Fast_IDCT();
  
  short num_input[] = {
    0,    1,    2,    3,    4,    5,    6,    7,
    8,    9,   10,   11,   12,   13,   14,   15,
   16,   17,   18,   19,   20,   21,   22,   23,
   24,   25,   26,   27,   28,   29,   30,   31,
   32,   33,   34,   35,   36,   37,   38,   39,
   40,   41,   42,   43,   44,   45,   46,   47,
   48,   49,   50,   51,   52,   53,   54,   55,
   56,   57,   58,   59,   60,   61,   62,   63
  };

  short num_output[] = {
      0x0,   0x0,   0x0,   0x1,   0x0,   0x1,   0x1ff, 0x6,
      0x0,   0x1ff, 0x0,   0x1ff, 0x1,   0x1fd, 0x4,   0x1f5,
      0x1,   0x2,   0x0,   0x3,   0x1fe, 0x6,   0x1f9, 0x1a,
      0x1ff, 0x1fe, 0x1,   0x1fc, 0x3,   0x1f8, 0xb,   0x1df,
      0x2,   0x4,   0x1ff, 0x7,   0x1fb, 0xd,   0x1ef, 0x3c,
      0x1fe, 0x1fb, 0x1,   0x1f7, 0x7,   0x1f0, 0x17,  0x1b9,
      0x5,   0xc,   0x1fd, 0x15,  0x1f1, 0x27,  0x1cc, 0xb0,
      0x1fc, 0x1f4, 0x5,   0x1ea, 0x13,  0x1d6, 0x3f,  0x153
  };

  TEST(num_input, num_output);
  
  short neg_input[] = {
     0,   -1,   -2,   -3,   -4,   -5,   -6,   -7,
    -8,   -9,  -10,  -11,  -12,  -13,  -14,  -15,
   -16,  -17,  -18,  -19,  -20,  -21,  -22,  -23,
   -24,  -25,  -26,  -27,  -28,  -29,  -30,  -31,
   -32,  -33,  -34,  -35,  -36,  -37,  -38,  -39,
   -40,  -41,  -42,  -43,  -44,  -45,  -46,  -47,
   -48,  -49,  -50,  -51,  -52,  -53,  -54,  -55,
   -56,  -57,  -58,  -59,  -60,  -61,  -62,  -63
  };

  short neg_output[] = {
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3
  };

  TEST(neg_input, neg_output);

  short input0[] = {
     23,  -1,  -2,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0
  };

  short output0[] = {
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3,
      2,   3,   3,   3,   3,   3,   3,   3
  };

  TEST(input0, output0);

  short input1[] = {
     13,  -7,   0,   0,   0,   0,   0,   0,
      0,   2,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0
  };

  short output1[] = {
      1,   1,   1,   1,   2,   2,   2,   2,
      1,   1,   1,   1,   2,   2,   2,   2,
      1,   1,   1,   1,   2,   2,   2,   3,
      1,   1,   1,   1,   2,   2,   3,   3,
      0,   1,   1,   1,   2,   2,   3,   3,
      0,   0,   1,   1,   2,   2,   3,   3,
      0,   0,   1,   1,   2,   3,   3,   3,
      0,   0,   1,   1,   2,   3,   3,   3,
  };

  TEST(input1, output1);

  short input2[] = {
   -166,  -7,  -4,  -4,   0,   0,   0,   0,
     -2,   0,   0,   0,   0,   0,   0,   0,
     -2,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0,
      0,   0,   0,   0,   0,   0,   0,   0
  };

  short output2[] = {
    -24, -23, -21, -21, -21, -21, -21, -20,
    -24, -22, -21, -20, -21, -21, -21, -20,
    -23, -22, -21, -20, -20, -21, -20, -20,
    -23, -22, -20, -20, -20, -20, -20, -19,
    -23, -22, -20, -20, -20, -20, -20, -19,
    -23, -22, -20, -20, -20, -20, -20, -19,
    -23, -22, -20, -20, -20, -20, -20, -19,
    -23, -22, -20, -20, -20, -20, -20, -20
  };

  TEST(input2, output2);

  short input3[] = {
   -240,   8, -11,  47,  26,  -6,   0,   5,
     28,  -6,  85,  44,  -4, -25,   5,  16,
     21,   8,  32, -16, -24,   0,  30,  12,
     -2,  18,   0,  -2,   0,   7,   0, -15,
      7,   4,  15, -24,   0,   9,   8,  -6,
      4,   9,   0,  -5,  -6,   0,   0,   0,
     -4,   0,  -6,   0,   0,  10, -10,  -8,
      6,   0,   0,   0,   0,   0,   0,  -8
  };

  short output3[] = {
     21, -10, -26, -61, -43, -17, -22,  -8,
      5, -28, -47, -73, -11, -14, -24, -17,
    -14, -31, -61, -45,  -5, -18, -22, -34,
    -23, -36, -49, -32, -12, -33, -33, -35,
    -30, -39, -53,  -8, -19, -31, -43, -42,
    -41, -43, -50,  -4, -15, -33, -44, -66,
    -40, -38, -21, -14, -17, -26, -46, -52,
    -44, -47,  -9, -12, -30, -33, -38, -37
  };

  TEST(input3, output3);

  printf("All tests passed\n");
  return 0;
}
